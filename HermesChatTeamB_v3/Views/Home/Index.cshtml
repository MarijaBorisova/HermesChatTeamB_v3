@{
    ViewData["Title"] = "Home Page";
}

<div class="text-center">
    <h1 class="display-4">Welcome</h1>
    <p>Learn about <a href="https://docs.microsoft.com/aspnet/core">building Web apps with ASP.NET Core</a>.</p>
</div>

@if(User.Identity.IsAuthenticated)
{
    <p>@User.Identity.Name</p>
 
    <form method="post" asp-controller="Account" asp-action="LogOff">
        <input type="submit" value="Sign Out" />
    </form>
}
else
{
    <a asp-controller="Account" asp-action="Login">Login</a>
    <a asp-controller="Account" asp-action="Register">Register</a>
}
<script src="~/lib/jquery/dist/jquery.js"></script>
<link href="~/css/site.css" rel="stylesheet" />
<script src="~/js/signalr-client-1.0.0-alpha1-final.js"></script>
<script src="~/js/signalr-clientES5-1.0.0-alpha1-final.js"></script>
<script src="~/js/signalr-msgpackprotocol-1.0.0-alpha1-final.js"></script>
<script type="text/javascript">
    let hubUrl = '/chatHub';
    let httpConnection = new signalR.HttpConnection(hubUrl);
    let hubConnection = new signalR.HubConnection(httpConnection);

    hubConnection.on('SetUsersOnline', usersOnline => {
        if (usersOnline.length > 0) {
            $('#onlineUsers').innerText = '';
            $.each(usersOnline, function (i, user) {
                addUserOnline(user);
            });
        }
    });

    hubConnection.on('UsersJoined', users => {
        if (users != null && typeof (users) != undefined) {
            appendLine(users.name + ' joined the chat room', 'green');
            addUserOnline(user);
        }
    });

    hubConnection.on('UsersLeft', users => {
        if (users != null && typeof (users) != undefined) {
            appendLine(users.name + ' left the chat room', 'red');
            document.getElementById(users.connectionId).outerHTML = '';
        }
    });


</script>